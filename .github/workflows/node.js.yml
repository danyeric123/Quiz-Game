# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: Node.js CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  dependabot:
      name: "Dependabot Auto-approve and Auto-Merge"
      runs-on: ubuntu-latest
      if: ${{ github.actor == 'dependabot[bot]' }}
      steps:
        - name: Dependabot metadata
          id: metadata
          uses: dependabot/fetch-metadata@v1.1.1
          with:
            github-token: "${{ secrets.GITHUB_TOKEN }}"
        - name: Enable auto-merge for Dependabot PRs
          if: ${{steps.metadata.outputs.update-type == 'version-update:semver-patch'}}
          run: gh pr merge --auto --rebase "$PR_URL"
          env:
            PR_URL: ${{github.event.pull_request.html_url}}
            GITHUB_TOKEN: ${{secrets.GITHUB_TOKEN}}
